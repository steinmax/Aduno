<p id = "page"></p>

<form onsubmit="return false;">
    <input id="loginUser" name="user" type="text">
    <input id="loginPasswd" name="passwd" type="password">
    
    <input type="submit" value="Login" onclick="login()">
</form>

<script>
    var page = document.getElementById("page");
    var deviceId = undefined;
    
	//------Functions-----------------------------------------------------------------------


    function appendText(text, newline) {
        page.innerHTML += text;

        if(newline)
            page.innerHTML += "<br>";
    }
    
    function generateGUID() {
        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
        );
    }

    function readDeviceIdFromStorage() {
       return localStorage.getItem("deviceId");
    }

    function saveDeviceIdToStorage(deviceId) {
        localStorage.setItem("deviceId", deviceId);
    }

    function login() {
        const formUser = document.getElementById("loginUser");
        const formPasswd = document.getElementById("loginPasswd");
       
        const result = {
            "user": formUser.value,
            "pass": formPasswd.value
        }

        appendText(result, true);
    }

	//------Entrypoint-----------------------------------------------------------------------

    var deviceId = readDeviceIdFromStorage();

    if(deviceId == undefined) {
        appendText("No deviceId in storage, generating new...", true);
        deviceId = generateGUID();
        saveDeviceIdToStorage(deviceId);
    }

    appendText(`DeviceId: ${deviceId}`, true);
</script>