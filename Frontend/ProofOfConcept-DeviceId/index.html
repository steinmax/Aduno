<p id = "page"></p>

<form id="loginForm" onsubmit="return false;" hidden>
    <input id="loginUser" name="user" type="text">
    <input id="loginPasswd" name="passwd" type="password">
    
    <input type="submit" value="Login" onclick="loginCallback()">
</form>

<script>
    var page = document.getElementById("page");
    var deviceId = undefined;
    
	//------Functions-----------------------------------------------------------------------


    function appendText(text, newline) {
        page.innerHTML += text;

        if(newline)
            page.innerHTML += "<br>";
    }
    
    function generateGUID() {
        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
        );
    }

    function readDeviceIdFromStorage() {
       return localStorage.getItem("deviceId");
    }

    function saveDeviceIdToStorage(deviceId) {
        localStorage.setItem("deviceId", deviceId);
    }

    function login() {
        const form = document.getElementById("loginForm");
        form.hidden = false;
    }

    function loginCallback() {
        const formUser = document.getElementById("loginUser");
        const formPasswd = document.getElementById("loginPasswd");
        const loginForm = document.getElementById("loginForm");
       
        const result = {
            "user": formUser.value,
            "pass": formPasswd.value,
            "deviceId": undefined
        }

        appendText(JSON.stringify(result), true);
        
        loginForm.hidden = true;

        //Usually fetch deviceId of user from database
        //  Testing purposes -> Hardcode deviceId associated with account "admin"
        if(result.user === "admin" && result.pass === "password")
            result.deviceId = "e42808c7-d300-47f3-a42d-bf5ad9f595e1";
            saveDeviceIdToStorage(result.deviceId);
    }

	//------Entrypoint-----------------------------------------------------------------------

    var deviceId = readDeviceIdFromStorage();

    if(deviceId == undefined) {
        appendText("Not logged in...", true);
        login();
    }

    appendText(`DeviceId: ${deviceId}`, true);
</script>