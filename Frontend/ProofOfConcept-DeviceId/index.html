<h1>ReSign DeviceId Test Website</h1>


<script>

	function onDeviceFetch(devices) {
		let result = undefined;

		devices.forEach(function(device) {
			if(device.kind === 'videoinput') {
				if(result == undefined) {
					document.write(device.kind + ": ");
					document.write(device.deviceId);

					document.write("<br>");
					result = device;
				}
			}
		});

		return result;
	}

	function requestCameraPermission() {
		//Find solution for this
		document.write("Requesting camera permission does not yet work, sorry...");
	}

	async function checkCameraPermission() {
		await navigator.permissions.query({name:'camera'}).then(function(result) {
			//alert(result.state);
			if (result.state === 'granted') {
				//permission has already been granted, no prompt is shown
				console.log("Camera permission is already granted.");
			} else if (result.state === 'prompt') {
				//there's no peristent permission registered, will be showing the prompt
				console.log("Camera permission not yet granted, showing promt.");

				requestCameraPermission();
			} else if (result.state === 'denied') {
				//permission has been denied
				console.log("Camera denied. Necessary for this!");
			}
		});
	}
	/*
	var cameraStream = navigator.mediaDevices.getUserMedia({ audio: false, video: true }).then((stream) => {
		//Ask (force) for camera permission
		stream.getVideoTracks().forEach(function(track) {
			track.stop();
		});

		*/

		//Ask (force) for camera permission
		checkCameraPermission();

		//List devices
		if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
			document.write("enumerateDevices() not supported.<br>");
		}else {
			// List cameras and microphones (all devices where we have permissions)

			navigator.mediaDevices.enumerateDevices()
			.then(onDeviceFetch)
			.catch(function(err) {
				document.write(err.name + ": " + err.message);
			});
		}
	//});

</script>