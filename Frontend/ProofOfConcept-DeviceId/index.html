<h1>ReSign DeviceId Test Website</h1>


<script>

	function onDeviceFetch(devices) {
		let result = undefined;

		devices.forEach(function(device) {
			if(device.kind === 'videoinput') {
				if(result == undefined) {
					document.write(device.kind + ": ");
					document.write(device.deviceId);

					document.write("<br>");
					result = device;
				}
			}
		});

		return result;
	}

	function requestCameraPermission() {
		//Find solution for this	
		
		
		navigator.mediaDevices.getUserMedia({ audio: false, video: true }).then((stream) => {
			//Ask (force) for camera permission
			stream.getVideoTracks().forEach(function(track) {
				track.stop();
			});
		});

		return false;
	}

	async function checkCameraPermission() {
		let result = false;

		let task = navigator.permissions.query({name:'camera'}).then(function(result) {
			alert(result.state);
			if (result.state === 'granted') {
				//permission has already been granted, no prompt is shown
				console.log("Camera permission is already granted.");
				result = true;
			} else if (result.state === 'prompt') {
				//there's no peristent permission registered, will be showing the prompt
				console.log("Camera permission not yet granted, showing promt.");

				result = requestCameraPermission();
			} else if (result.state === 'denied') {
				//permission has been denied
				console.log("Camera denied. Necessary for this!");
				result = false;
			}
		});

		await task;
		return result;
	}

	//Ask (force) for camera permission
	checkCameraPermission().then(success => {
		console.log(success);

		//List devices
		if (success && !navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
			document.write("enumerateDevices() not supported.<br>");
		}
		else if(success){
			// List cameras and microphones (all devices where we have permissions)

			navigator.mediaDevices.enumerateDevices()
			.then(onDeviceFetch)
			.catch(function(err) {
				document.write(err.name + ": " + err.message);
			});
		}
	});

</script>