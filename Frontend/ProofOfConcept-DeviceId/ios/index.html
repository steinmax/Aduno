<p id = "page"></p>

<script>
    const NO_CAMERA_FOUND = "No suitable camera device found";

    var page = document.getElementById("page");
    var deviceId = "";

    function appendText(text, newline) {
        page.innerHTML += text;

        if(newline)
            page.innerHTML += "<br>";
    }

	function onDeviceFetch(devices) {
		let result = undefined;

        console.log(devices);

		devices.forEach(function(device) {
			if(device.kind === 'videoinput') {
				if(result == undefined) {
					//appendText(device.kind + ": " + device.deviceId, true);
					deviceId = device.deviceId;
					result = device;
				}
			}
		});

        if(result == undefined)
            throw NO_CAMERA_FOUND;

		return result;
	}

    async function fetchDeviceId(){
        await navigator.mediaDevices.enumerateDevices()
        .then(onDeviceFetch)
        .catch(function(err) {
            console.log(err.name + ": " + err.message, true);
            if(err === NO_CAMERA_FOUND)
                appendText("Couldn't access deviceId, please grant access to the camera for this website.");
        });
    }

    //List devices
    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
        appendText("enumerateDevices() not supported.", true);
    }
    else {
        // Get deviceId from camera device
        fetchDeviceId().then(() => {
            appendText(deviceId);
        });        
    }
</script>